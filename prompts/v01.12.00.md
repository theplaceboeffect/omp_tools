# v01.12.x - Minor updates.

PROMPT: execute remaining tasks in prompt v01.12.00.md


## TASKS ##

### 1. Fix duplicate help code.

1. [x] . ./dot-oh-my-posh.ps1 -h 
      doesnt show information about installation - why? don't change code.
      there should ony be one help message - please refactor

### 2. PowerShell 5 fixes.

1. [x] Update ./dot-oh-my-posh.ps1 to abort if not run under pwsh
1. [x] Fix syntax errors when running under PowerShell 5
1. [x] Remove duplicate opm_install function in ./dot-oh-my-posh.ps1 

### 3. Maintaintenance
1. [x] move the always section in prompt v01.13 to cursor rule files.

### 4. Code Review
1. [x] Review code and append a list of action items for future improvement.
1. [x] Update the pass/fail messages to include whether it's for bash, powershell or zsh.

## CODE REVIEW FINDINGS - ACTION ITEMS FOR FUTURE IMPROVEMENT

### Changes needed for dot-oh-my-posh.zsh
- [x]  **Version mismatch**: Version shows v01.10.02 in hardcoded string (line 65) but header shows v01.11.02
- [x]  ~~**Missing omp wrapper function**: Unlike PowerShell version, zsh lacks unified `omp` command wrapper~~ (INCORRECT - omp function exists at line 386)
- [x]  **Inconsistent array indexing**: Uses 1-based indexing in for loops (lines 207, 259) which may cause issues
- [x]  **Redundant help function comment**: Line 383 has orphaned comment "Help function (moved earlier)"
- [x]  **Install path inconsistency**: Install path uses `.oh-my-posh-tools.zsh` but instructions reference different path
- [x]  **Error handling**: Missing error handling for theme file operations and oh-my-posh command failures


### Changes needed for dot-oh-my-posh.ps1
- [x]  **Version mismatch**: Version shows v01.12.01 in hardcoded string (line 21) but header shows v01.11.02
- [x]  **Typo in output**: Line 173 has "xPackage Manager:" instead of "Package Manager:"
- [x]  **Inconsistent error handling**: Some functions lack proper error handling for missing oh-my-posh installation
- [x]  **PowerShell 7 requirement**: Consider adding fallback or graceful degradation for PowerShell 5 users
- [x]  **Theme validation**: No validation that selected themes actually exist before attempting to set them
- [x]  **Path handling**: Windows path handling could be more robust with proper escaping

# ***** IGNORE BELOW *******

### Changes needed for dot-oh-my-posh.bash
- [ ]  **Version mismatch**: Version shows v01.10.02 in hardcoded string (line 80) but header shows v01.11.02
- [ ]  **Duplicate environment check**: Environment info is shown twice when using -e flag (lines 99-110 and 189-200)
- [ ]  **Array indexing**: Uses 1-based indexing in for loops which may not work correctly in all bash versions
- [ ]  **Install function**: Install path in function doesn't match instructions (line 391 vs line 380)
- [ ]  **Missing omp wrapper**: No unified `omp` command wrapper like in other versions
- [ ]  **Bash version check**: Should be more robust in checking for bash 5+ features

### Changes needed for run_all_tests.sh
- [ ]  **Hardcoded paths**: Uses hardcoded Homebrew bash path that may not exist on all systems
- [ ]  **Test organization**: Could benefit from better test categorization and reporting
- [ ]  **Error aggregation**: No summary of total passed/failed tests
- [ ]  **Parallel execution**: Tests run sequentially, could be parallelized for faster execution
- [ ]  **Exit codes**: Doesn't properly aggregate exit codes from individual tests
- [ ]  **Platform detection**: Could better detect and handle different platforms

### Changes needed for test_bash_omp_envs.sh
- [ ]  **Function name**: Tests `omp_env` but script is named `test_bash_omp_envs.sh` (plural)
- [ ]  **Dependency on external tools**: Relies on Homebrew bash detection which may not be available
- [ ]  **Test isolation**: Doesn't clean up environment after testing
- [ ]  **Error reporting**: Could provide more detailed error information when tests fail

### Changes needed for test_bash_omp_help.sh
- [ ]  **Pattern matching**: Could be more specific in pattern matching to avoid false positives
- [ ]  **Output validation**: Should validate actual content quality, not just presence of keywords
- [ ]  **Test coverage**: Doesn't test help flag functionality (-h)

### Changes needed for test_bash_omp_ls.sh
- [ ]  **Output parsing**: Expects .omp.json files but omp_ls may return theme names without extensions
- [ ]  **Path validation**: Doesn't verify that listed themes actually exist in filesystem
- [ ]  **Empty directory handling**: Doesn't handle case where themes directory is empty

### Changes needed for test_bash_omp_set.sh
- [ ]  **Theme validation**: Doesn't test actual theme setting functionality, only output format
- [ ]  **State management**: Doesn't verify that theme setting actually changes the environment
- [ ]  **Default theme testing**: Should test setting and retrieving default themes

### Changes needed for test_ps1_omp_envs.ps1
- [ ]  **Temporary file cleanup**: Uses temp files but cleanup could be more robust
- [ ]  **Output redirection**: Complex output redirection could be simplified
- [ ]  **Error handling**: Should handle cases where PowerShell functions throw exceptions

### Changes needed for test_ps1_omp_help.ps1
- [ ]  **Output capture**: Same temp file complexity as other PS1 tests
- [ ]  **Content validation**: Could validate specific help content rather than just structure
- [ ]  **Cross-platform testing**: Should account for different PowerShell behaviors on different platforms

### Changes needed for test_ps1_omp_ls.ps1
- [ ]  **Output format**: Expects .omp.json files but PowerShell omp_ls returns clean theme names
- [ ]  **Error scenarios**: Doesn't test error conditions like missing themes directory
- [ ]  **Performance**: Could test performance with large numbers of themes

### Changes needed for test_ps1_omp_set.ps1
- [ ]  **Theme persistence**: Doesn't test if theme changes persist across PowerShell sessions
- [ ]  **Invalid theme handling**: Should test behavior with non-existent themes
- [ ]  **Default theme logic**: Could test the default theme fallback mechanism

### Changes needed for test_zsh_omp_envs.sh
- [ ]  **Function consistency**: Same issues as bash version regarding function naming
- [ ]  **Zsh-specific features**: Could leverage zsh-specific testing features
- [ ]  **Completion testing**: Should test tab completion functionality

### Changes needed for test_zsh_omp_help.sh
- [ ]  **Help flag testing**: Should test both `omp_help` function and `-h` flag behavior
- [ ]  **Interactive help**: Could test help in interactive vs non-interactive contexts

### Changes needed for test_zsh_omp_ls.sh
- [ ]  **Completion integration**: Should test that omp_ls output works with zsh completion
- [ ]  **Performance**: Could test performance with large theme collections
- [ ]  **Alias testing**: Should verify that alias works correctly

### Changes needed for test_zsh_omp_set.sh
- [ ]  **Interactive testing**: Could test omp_show interactive functionality
- [ ]  **Completion testing**: Should test tab completion for theme names
- [ ]  **Theme validation**: Should test setting invalid themes and error handling